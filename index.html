<!-- ... (tout le reste du code inchangé jusqu'au footer) -->

<!-- Formulaire d'envoi d'email -->
<h2>Envoyer un email</h2>
<div class="email-box">
  <form id="sendEmailForm" onsubmit="sendEmail(event)">
    <label>À : <input type="email" id="toEmail" required /></label><br><br>
    <label>Sujet : <input type="text" id="subject" required /></label><br><br>
    <label>Message :</label><br>
    <textarea id="message" rows="5" style="width: 100%;" required></textarea><br><br>
    <button type="submit">Envoyer</button>
  </form>
  <div id="sendResult"></div>
</div>

<!-- ... Footer déjà présent ... -->

<script>
  let currentEmail = "";

  window.onload = async function () {
    const res = await fetch('/api/email');
    const data = await res.json();
    currentEmail = data.email;
    document.getElementById('emailDisplay').textContent = currentEmail;
  };

  function copyEmail() {
    navigator.clipboard.writeText(currentEmail).then(() => {
      alert("Email copié !");
    });
  }

  async function refreshMessages() {
    const res = await fetch(`https://mailsac.com/api/addresses/${currentEmail}/messages`, {
      headers: {
        'Mailsac-Key': 'k_7zCBw6nPlhRCS4HNlYSQH8I7hidMGtcU8SpcPX1yDg66e4'
      }
    });
    const messages = await res.json();
    const container = document.getElementById("messages");
    container.innerHTML = "";

    if (!messages.length) {
      container.innerHTML = "<p>Aucun message pour l'instant.</p>";
      return;
    }

    messages.forEach(m => {
      const div = document.createElement("div");
      div.className = "message";
      div.innerHTML = `
        <p><strong>De :</strong> ${m.from}</p>
        <p><strong>Sujet :</strong> ${m.subject}</p>
        <button onclick="readMessage('${m._id}')">Lire</button>
        <div id="body-${m._id}"></div>
      `;
      container.appendChild(div);
    });
  }

  async function readMessage(id) {
    const res = await fetch(`https://mailsac.com/api/text/${currentEmail}/${id}`, {
      headers: {
        'Mailsac-Key': 'k_7zCBw6nPlhRCS4HNlYSQH8I7hidMGtcU8SpcPX1yDg66e4'
      }
    });
    const body = await res.text();
    document.getElementById(`body-${id}`).innerHTML = `<pre>${body}</pre>`;
  }

  async function sendEmail(e) {
    e.preventDefault();

    const to = document.getElementById("toEmail").value;
    const subject = document.getElementById("subject").value;
    const text = document.getElementById("message").value;

    const response = await fetch("https://api.mailersend.com/v1/email", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer mlsn.d872cab7fbfad60b1b76aa09452e55ebb5adc233cc8a14d8886b3c0bb71e5e32"
      },
      body: JSON.stringify({
        from: {
          email: currentEmail,
          name: "Temp Mail"
        },
        to: [{ email: to }],
        subject: subject,
        text: text
      })
    });

    const resultBox = document.getElementById("sendResult");

    if (response.ok) {
      resultBox.innerHTML = "<p style='color:green;'>Email envoyé avec succès !</p>";
      document.getElementById("sendEmailForm").reset();
    } else {
      const err = await response.json();
      resultBox.innerHTML = `<p style='color:red;'>Erreur : ${err.message || 'Échec de l’envoi.'}</p>`;
    }
  }
</script>